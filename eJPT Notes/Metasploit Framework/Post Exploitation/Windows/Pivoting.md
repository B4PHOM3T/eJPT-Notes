
+ Pivoting is a post exploitation technique that involves utilizing a compromised host to attack other systems on the compromised host's private internal network.

+ After gaining access to one host, we can use the compromised host to exploit other hosts on the same internal network to which we could not access previously.

+ Meterpreter provides us with the ability to add a network route to the internal network's subnet and consequently scan and exploit other systems on the network.

![[Pasted image 20231011204806.png]]

### How to pivot ?

1. We can first try and ping the first and second victim machines. One of them should be in a different subnet and we shouldn't be able to ping them. 

2. We will gain access to the target system which is accessible to us.

3. After gaining access to the target machine, we can use `ipconfig` inside `shell` in the target machine to check the various interfaces available. In our case, both the victim machines are in the same subnet.

4. Since now we have a session open on a compromised host within the target network, we can use the `autoroute` command to specify the target subnets that you want to route through the compromised host.
```
run autoroute -s 10.2.27.0/20
```

5. Once the routing is set up, any traffic destined for the specified subnets will be forwarded through the compromised host, allowing you to intercept and analyze network traffic.

6. We can now use the TCP portscan module to run a scan on the previously inaccessible host in the subnet.
```
use auxiliary/scanner/portscan/tcp
```

7. Since this route is only accessible through `msfconsole`, we cannot interact with the second host outside `msfconsole`.

8. Since we cannot perform a `db_nmap` scan on victim 2 directly, we need to setup port forwarding. 
```
portfwd add -l 1234 -p <remote-port> -r <host-IP>
```
- In this case, we are forwarding the remote port to our local port 1234.
- This will allow us to a service version scan.

9. Now that the remote port has been forwarded successfully, we can perform a `nmap` scan.
```
db_nmap -sV -p 1234 localhost
```
- We are scanning port 1234 since we have forwarded the remote port to our local port 1234 on the local host.

10. The only reason we've performed port forwarding is so that we can scan and enumerate the vulnerable services in victim 2.

11. In our case, we've discovered a vulnerable bad blue service running. We'll set the payload to a `bind_tcp` payload, since reverse TCP connection is not possible.
```
set payload windows/meterpreter/bind_tcp
```
- Set `RHOST` to the victim 2 IP.
- We don't need to change the `RPORT` since we've added a route in `msfconsole`.

12. After exploiting, we can change the session name to victim 2.
```
sessions -n victim-2 -i 2
```

